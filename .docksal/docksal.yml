# Docker and Docker Compose based environment for Drupal.
# See https://github.com/docksal/docksal for more information and documentation.

# This is a shared configuration file that is intended to be stored in the project repo.
# For local overrides:
# - create .docksal/docksal-local.yml file and put local docker-compose configuration overrides there
# - add .docksal/docksal-local.yml to .gitignore

# Docksal stiches several docker-compose configuration files together.
# Run "fin config" to see which files are involved and the resulting configration.

version: "2.1"

services:

  elastic:
    image: elasticsearch
    mem_limit: 4096m
    labels:
      - io.docksal.virtual-host=elastic.${VIRTUAL_HOST}
    ports:
      - "9200:9200"
      - "9300:9300"

  web:
    image: registry.acolono.net:444/rosenstrauch/hoaxly-vanillasearch-nginx
    ports:
      - "8080:80"
    labels:
      - io.docksal.virtual-host=search.${VIRTUAL_HOST}
      - io.docksal.project-root=${PROJECT_ROOT}

    depends_on:
      - php
    environment:
      - APP_ES_HOST=elastic
      - APP_ES_PORT=9200
      - APP_LOG_FILE=/vanillasearch.log

  php:
    image: registry.acolono.net:444/rosenstrauch/hoaxly-vanillaphp:latest


  kibana:
    image: kibana
    mem_limit: 1024m
    ports:
      - "5601:5601"
    depends_on:
      - elastic
    environment:
      - ELASTICSEARCH_URL=http://elastic:9200
 #
 # scrapyd:
 #   image: vimagick/scrapyd
 #   ports:
 #     - "6800:6800"
 #   depends_on:
 #     - elastic
 #   volumes:
 #     - project_root:/hoaxly

  portia:
    image: scrapinghub/portia
    mem_limit: 1024m
    ports:
      - "9001:9001"
    labels:
      - io.docksal.virtual-host=portia.${VIRTUAL_HOST}
    volumes:
      - ${PWD}/portia_projects:/app/data/projects:rw
      - ${PWD}/config/local_slybot_settings.py:/app/slyd/slybot/slybot/local_slybot_settings.py
